import{r as e,j as n,b5 as t,b6 as r,a as o}from"./index-G_uMOMri.js";const i=e.forwardRef((({as:e="div",...t},r)=>n.jsx(e,{...t,ref:r}))),s="cf-turnstile-script",c="onloadTurnstileCallback",a={normal:{width:300,height:65},compact:{width:130,height:120},invisible:{width:0,height:0,overflow:"hidden"},interactionOnly:{width:"fit-content",height:"auto"}};function l(e){let n;return"invisible"!==e&&(n=e),n}function u(n=s){const[t,r]=e.useState(!1);return e.useEffect((()=>{const e=()=>{const e=(e=>!!document.querySelector(`#${e}`))(n);e&&r(!0)},t=new MutationObserver(e);return t.observe(document,{childList:!0,subtree:!0}),e(),()=>{t.disconnect()}}),[n]),t}const d=e.forwardRef(((t,r)=>{const{scriptOptions:o,options:d={},siteKey:f,onSuccess:p,onExpire:w,onError:v,onBeforeInteractive:x,onAfterInteractive:h,onUnsupported:m,id:b,style:y,as:E="div",injectScript:g=!0,...k}=t,S=d.size??"normal",[T,j]=e.useState("execute"===d.execution?a.invisible:"interaction-only"===d.appearance?a.interactionOnly:a[S]),O=e.useRef(null),R=e.useRef(!1),[C,N]=e.useState(),[$,I]=e.useState(!1),L=u((null==o?void 0:o.id)||s),z=b??"cf-turnstile",F=`${(null==o?void 0:o.onLoadCallbackName)||c}#${z}`,K=e.useMemo((()=>({sitekey:f,action:d.action,cData:d.cData,callback:p,"error-callback":v,"expired-callback":w,"before-interactive-callback":x,"after-interactive-callback":h,"unsupported-callback":m,theme:d.theme??"auto",language:d.language??"auto",tabindex:d.tabIndex,"response-field":d.responseField,"response-field-name":d.responseFieldName,size:l(S),retry:d.retry??"auto","retry-interval":d.retryInterval??8e3,"refresh-expired":d.refreshExpired??"auto",execution:d.execution??"render",appearance:d.appearance??"always"})),[f,d,p,v,w,S,x,h,m]),M=e.useMemo((()=>JSON.stringify(K)),[K]);return e.useImperativeHandle(r,(()=>{if("undefined"==typeof window||!L)return;const{turnstile:e}=window;return{getResponse(){if((null==e?void 0:e.getResponse)&&C)return e.getResponse(C);console.warn("Turnstile has not been loaded")},reset(){if((null==e?void 0:e.reset)&&C){"execute"===d.execution&&j(a.invisible);try{e.reset(C)}catch(n){console.warn(`Failed to reset Turnstile widget ${C}`,n)}}else console.warn("Turnstile has not been loaded")},remove(){(null==e?void 0:e.remove)&&C?(N(""),j(a.invisible),e.remove(C)):console.warn("Turnstile has not been loaded")},render(){if(!(null==e?void 0:e.render)||!O.current||C)return void console.warn("Turnstile has not been loaded or widget already rendered");const n=e.render(O.current,K);return N(n),"execute"!==d.execution&&j(a[S]),n},execute(){"execute"===d.execution&&((null==e?void 0:e.execute)&&O.current&&C?(e.execute(O.current,K),j(a[S])):console.warn("Turnstile has not been loaded or widget has not been rendered"))}}}),[L,C,d.execution,S,K,O]),e.useEffect((()=>(window[F]=()=>I(!0),()=>{delete window[F]})),[F]),e.useEffect((()=>{g&&!$&&(({render:e="explicit",onLoadCallbackName:n=c,scriptOptions:{nonce:t="",defer:r=!0,async:o=!0,id:i="",appendTo:a}={}})=>{const l=i||s,u=document.createElement("script");u.id=l,u.src=`https://challenges.cloudflare.com/turnstile/v0/api.js?onload=${n}&render=${e}`,u.defer=!!r,u.async=!!o,t&&(u.nonce=t),("body"===a?document.body:document.getElementsByTagName("head")[0]).appendChild(u)})({onLoadCallbackName:F,scriptOptions:o})}),[g,$,F,o]),e.useEffect((()=>{!g&&L&&!$&&window.turnstile&&I(!0)}),[g,$,L]),e.useEffect((()=>{if(!f)return void console.warn("sitekey was not provided");if(!L||!O.current||!$||R.current)return;const e=window.turnstile.render(O.current,K);N(e),R.current=!0}),[L,f,K,R,$]),e.useEffect((()=>{if(O.current&&C){window.turnstile.remove(C);const e=window.turnstile.render(O.current,K);N(e),R.current=!0}}),[M,f]),e.useEffect((()=>()=>{C&&window.turnstile&&window.turnstile.remove(C)}),[C]),e.useEffect((()=>{j("execute"===d.execution?a.invisible:"interaction-only"===K.appearance?a.interactionOnly:a[S])}),[d.execution,S,K.appearance]),n.jsx(i,{ref:O,as:E,id:z,style:{...T,...y},...k})}));function f(i){const{currentTheme:s}=t(),c=e.useRef(null);return e.useEffect((()=>{i.ref&&i.ref.current&&(i.ref.current.reset=()=>{var e;null==(e=c.current)||e.reset()})}),[]),n.jsxs("div",{style:{margin:"auto",width:"300px"},children:[n.jsx(d,{ref:c,siteKey:r.cfSiteKey,options:{theme:s,action:i.action},onSuccess:e=>{i.onSuccess&&i.onSuccess(e)},onExpire:()=>{i.onExpire&&i.onExpire()},onError:()=>{var e;i.onError&&i.onError(),null==(e=c.current)||e.reset()},style:{position:"relative"}}),n.jsx(o,{onClick:()=>{var e;null==(e=c.current)||e.reset(),i.onExpire&&i.onExpire()},fontSize:"xs",children:"Tải lại captcha"})]})}d.displayName="Turnstile";export{f as C};
