import{j as e,B as s,b7 as n,r as a,b8 as r,u as i,F as l,W as t,b9 as c,C as o,am as d,k as h,c as x,T as m,an as u,l as j,aC as f,ba as g,bb as v,aZ as p,b as _,az as b,aA as C,aq as y,ae as N}from"./index-G_uMOMri.js";import I from"./Home-Sxbek_nV.js";const U={Profile:"_Profile_14dq8_1",ProfileTop:"_ProfileTop_14dq8_8",show:"_show_14dq8_18",ProfileCover:"_ProfileCover_14dq8_37",noCover:"_noCover_14dq8_49",ProfileOverlay:"_ProfileOverlay_14dq8_52",CoverChanger:"_CoverChanger_14dq8_62",ProfileMain:"_ProfileMain_14dq8_72",Info:"_Info_14dq8_77",User:"_User_14dq8_87",UserInfo:"_UserInfo_14dq8_88",UserAvatar:"_UserAvatar_14dq8_94",isMine:"_isMine_14dq8_102",UserDesc:"_UserDesc_14dq8_130",UserInfoText:"_UserInfoText_14dq8_138",UserInfoIcon:"_UserInfoIcon_14dq8_142",Content:"_Content_14dq8_145",ContentInner:"_ContentInner_14dq8_150"};function M({uid:n,isMine:a}){return e.jsx(e.Fragment,{children:e.jsx(s,{variant:"outlined",className:U.ContentInner,children:e.jsx(I,{uid:n,isMine:a})})})}function k(){const{uid:I}=n(),{MainScreenRef:k}=a.useContext(r),[q,P]=a.useState(!1),S=a.useRef(null),T=a.useRef(null),F=i(),[L,w]=a.useState({}),[z,D]=a.useState(""),[R,E]=a.useState(""),[A,H]=a.useState(null),[B,O]=a.useState(null),[G,K]=a.useState(!1),[V,Z]=a.useState(!1),[J,Q]=a.useState("Đang tải trang cá nhân..."),W=a.useCallback((()=>{!V&&L.isMine&&T.current.click()}),[L,V]),X=a.useCallback((()=>{!G&&L.isMine&&S.current.click()}),[L,G]),Y=a.useCallback((e=>{if(V||!L.isMine)return;const s=e.target.files[0];0!==s.length&&s.type.includes("image/")?O(e.target.files[0]):(e.target.value="",F.error("Chỉ chấp nhận tệp ảnh!"))}),[F,L.isMine,V]),$=a.useCallback((e=>{if(G||!L.isMine)return;const s=e.target.files[0];0!==s.length&&s.type.includes("image/")?H(e.target.files[0]):(e.target.value="",F.error("Chỉ chấp nhận tệp ảnh!"))}),[F,L.isMine,G]),ee=a.useCallback((e=>{if(null!==B||null!==A){var s=new FormData;s.append("image",e?A:B),s.append("type",e?"cover":"avatar"),l({url:"profile/updateImage",data:s,beforeSend:()=>{e?K(!0):Z(!0)},success:s=>{e?(K(!1),w({...L,cover:s.message}),H(null),D(""),F.success("Đã cập nhật ảnh bìa thành công!")):(Z(!1),w({...L,avatar:s.message}),O(null),E(""),F.success("Đã cập nhật ảnh đại diện thành công!"))},error:s=>{e?K(!1):Z(!1),F.error(""!==s.message?s.message:"Lỗi không xác định!")}})}else F.error("Ảnh trả về giá trị null! Vui lòng nhấn nút lưu lại thêm 1 lần nữa!")}),[F,B,A,L]),se=a.useCallback((()=>{!V&&L.isMine&&ee(!1)}),[V,L.isMine,ee]),ne=a.useCallback((()=>{!G&&L.isMine&&ee(!0)}),[G,L.isMine,ee]);a.useEffect((()=>{if(null!==B){var e=new FileReader;e.onload=e=>{E(e.target.result)},e.readAsDataURL(B)}}),[B]),a.useEffect((()=>{if(null!==A){var e=new FileReader;e.onload=e=>{D(e.target.result)},e.readAsDataURL(A)}}),[A]);const ae=a.useCallback((()=>{l({url:"profile",data:{uid:I},beforeSend:()=>w({}),success:e=>{w(e.data),Q(e.data.name)},error:e=>{Q("Đã xảy ra lỗi"),F.error(""!==e.message?e.message:"Lỗi không xác định!")}})}),[F,I]);a.useEffect((()=>{ae()}),[ae]);return a.useEffect((()=>{const e=e=>{e.target.scrollTop>=300?P(!0):P(!1)};return k.current.addEventListener("scroll",e),()=>{k.current&&k.current.removeEventListener("scroll",e)}}),[k,q]),e.jsxs(e.Fragment,{children:[e.jsx(t,{children:e.jsx("title",{children:J+" | Mon Fansub"})}),e.jsx("div",{className:U.Profile,children:c.isEmpty(L)?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:U.ProfileCover,children:e.jsx("div",{className:U.ProfileOverlay})}),e.jsxs("div",{className:U.ProfileMain,children:[e.jsx(o,{variant:"outlined",className:U.Info,children:e.jsx("div",{className:U.User,children:e.jsx(d,{className:U.UserAvatar})})}),e.jsx("div",{className:U.Content,style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"3rem",marginBottom:"1rem"},children:e.jsx(h,{size:"lg"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(o,{variant:"outlined",orientation:"horizontal",className:x(U.ProfileTop,q&&U.show),children:[e.jsx(d,{srcSet:R||L.avatar}),e.jsxs(m,{level:"h6",sx:{flexGrow:1,alignItems:"center",display:"flex"},fontSize:13,children:[L.name,e.jsx(u,{verifyLevel:L.verify,mod:L.moderator,style:{marginLeft:5},badgeSize:10})]}),e.jsx(j,{onClick:()=>{k.current.scrollTop=0},children:e.jsx("i",{className:"fa-duotone fa-up-to-line"})})]}),L.isMine&&e.jsxs("div",{style:{display:"none"},children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/gif",onChange:$,ref:S}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/gif",onChange:Y,ref:T})]}),e.jsx("div",{className:x(U.ProfileCover,!L.cover&&!z&&U.noCover),style:{backgroundImage:"url("+(z||L.cover)+")"},children:e.jsx("div",{className:U.ProfileOverlay,children:L.isMine&&e.jsx("div",{className:U.CoverChanger,children:e.jsx(f,{title:"Thay ảnh bìa",variant:"plain",children:e.jsx(j,{onClick:X,children:e.jsx("i",{className:"fa-duotone fa-image"})})})})})}),e.jsxs("div",{className:U.ProfileMain,children:[e.jsxs(o,{variant:"outlined",className:U.Info,children:[e.jsxs("div",{className:U.User,children:[e.jsx(d,{onClick:W,className:x(U.UserAvatar,L.isMine&&U.isMine),srcSet:R||L.avatar}),e.jsxs("h3",{children:[L.name,e.jsx(u,{verifyLevel:L.verify,mod:L.moderator,style:{marginLeft:5}})]}),e.jsx("div",{className:U.UserDesc,children:e.jsx(g,{disallowedElements:["h1","h2","h3","h4","h5","h6","code","pre","li","ul","ol","img"],remarkPlugins:[v],skipHtml:!0,children:L.story})})]}),z&&e.jsx(p,{variant:"outlined",sx:{margin:"0.5rem 0",padding:"8px",borderRadius:"8px"},children:G?e.jsx(m,{level:"body1",startDecorator:e.jsx(h,{sx:{mr:1}}),children:"Đang lưu ảnh bìa..."}):e.jsxs(e.Fragment,{children:[e.jsx(m,{level:"body1",mb:1,children:"Bạn đang xem trước ảnh bìa"}),e.jsxs(s,{sx:{display:"flex",justifyContent:"end"},children:[e.jsx(_,{onClick:ne,size:"sm",sx:{mr:1},children:"Lưu lại"}),e.jsx(_,{onClick:()=>{D(""),H(null)},size:"sm",color:"danger",children:"Hủy bỏ"})]})]})}),R&&e.jsx(p,{variant:"outlined",sx:{margin:"0.5rem 0",padding:"8px",borderRadius:"8px"},children:V?e.jsx(m,{level:"body1",startDecorator:e.jsx(h,{sx:{mr:1}}),children:"Đang lưu ảnh đại diện..."}):e.jsxs(e.Fragment,{children:[e.jsx(m,{level:"body1",mb:1,children:"Bạn đang xem trước ảnh đại diện"}),e.jsxs(s,{sx:{display:"flex",justifyContent:"end"},children:[e.jsx(_,{onClick:se,size:"sm",sx:{mr:1},children:"Lưu lại"}),e.jsx(_,{onClick:()=>{E(""),O(null)},size:"sm",color:"danger",children:"Hủy bỏ"})]})]})}),e.jsx("div",{className:U.UserInfo,children:e.jsxs(b,{sx:{width:"100%"},children:[L.student&&e.jsxs(C,{children:[e.jsx(y,{children:e.jsx("i",{className:"fa-duotone fa-graduation-cap"})}),e.jsxs("p",{className:U.UserInfoText,children:["Đã học tại ",e.jsx("b",{children:L.student})]})]}),(L.job||L.job_at)&&e.jsxs(C,{children:[e.jsx(y,{className:U.UserInfoIcon,children:e.jsx("i",{className:"fa-duotone fa-briefcase"})}),e.jsx("p",{className:U.UserInfoText,children:L.job_at&&L.job?e.jsxs(e.Fragment,{children:[e.jsx("b",{children:L.job})," tại ",e.jsx("b",{children:L.job_at})]}):L.job?e.jsx(e.Fragment,{children:L.job}):e.jsxs(e.Fragment,{children:["Làm việc tại ",e.jsx("b",{children:L.job_at})]})})]}),L.live&&e.jsxs(C,{children:[e.jsx(y,{className:U.UserInfoIcon,children:e.jsx("i",{className:"fa-duotone fa-buildings"})}),e.jsxs("p",{className:U.UserInfoText,children:["Sống tại ",e.jsx("b",{children:L.live})]})]}),L.relationship>0&&e.jsxs(C,{children:[e.jsx(y,{className:U.UserInfoIcon,children:e.jsx("i",{className:"fa-duotone fa-heart"})}),e.jsx("p",{className:U.UserInfoText,children:["Không công khai","Độc thân","Hẹn hò","Đang tìm hiểu","Đã kết hôn","Đã ly hôn"][L.relationship]})]}),L.follower>0&&e.jsxs(C,{children:[e.jsx(y,{className:U.UserInfoIcon,children:e.jsx("i",{className:"fa-duotone fa-rss"})}),e.jsxs("p",{className:U.UserInfoText,children:["Có  ",e.jsx("b",{children:L.follower}),"  người theo dõi"]})]}),L.isMine&&e.jsx(N,{to:"/setting/account",children:e.jsx(_,{variant:"soft",sx:{width:"100%"},startDecorator:e.jsx("i",{className:"fa-duotone fa-pen-to-square"}),children:"Chỉnh sửa thông tin"})})]})})]}),e.jsx("div",{className:U.Content,children:e.jsx(M,{uid:L.id,isMine:L.isMine})})]})]})})]})}export{k as default};
