import{u as e,a_ as n,r as a,ai as s,j as t,C as r,ad as i,l,ae as o,T as d,D as h,ac as c,d as u,a$ as x,I as g,b2 as j,b as p}from"./index-aT0gUlje.js";import{c as m,I as f}from"./ImageUploader-FFDy2Hu5.js";import{C as v}from"./Captcha-LofZUm_j.js";function b(){const b=e(),k=n(),[C,S]=a.useState(null),[w,E]=a.useState(!1),[P,T]=a.useState(""),[V,y]=a.useState(""),[D,I]=a.useState(""),L=a.useCallback((async()=>{if(V.length<5||V.length>125)return void b.error("Tiêu đề phải trên 5 ký tự và không quá 125 ký tự");if(null===C)return void b.error("Vui lòng chọn ảnh!");if(!P)return void b.error("Vui lòng hoàn tất xác minh!");const e=new FormData;if(null!==C){e.append("image",C),e.append("pt","image"),e.append("title",V),e.append("content",D),e.append("token",P);try{E(!0);if(!0===(await s({url:"uploadPost",method:"POST",data:e})).ok)return b.success("Đã đăng hình ảnh"),void k("/")}catch(n){E(!1),b.error(n.message?n.message:"Lỗi không xác định!")}}}),[P,C,D,V]);return a.useEffect((()=>{function e(e){""===V&&""===D&&null===C||(e.preventDefault(),e.returnValue="")}return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)}),[V,D,C]),t.jsx("div",{className:m.HomePost,children:t.jsxs(r,{variant:"soft",className:m.Main,children:[t.jsxs(i,{sx:{pt:0},children:[t.jsx(l,{component:o,to:"/",children:t.jsx("i",{className:"fa-solid fa-chevron-left"})}),t.jsx(d,{level:"title-lg",children:"Đăng hình ảnh"})]}),t.jsx(h,{}),t.jsxs(c,{children:[t.jsxs(u,{disabled:w,sx:{mb:2},children:[t.jsxs(x,{children:["Tiêu đề",t.jsx(d,{color:"danger",children:"*"})]}),t.jsx(g,{value:V,onChange:e=>y(e.target.value),placeholder:"Vui lòng ghi tiêu đề (bắt buộc)"})]}),t.jsxs(u,{disabled:w,sx:{mb:2},children:[t.jsx(x,{children:"Mô tả"}),t.jsx(j,{placeholder:"Mô tả hình ảnh này",required:!0,sx:{mb:1},value:D,onChange:e=>I(e.target.value)})]}),t.jsxs(u,{disabled:w,sx:{mb:2},children:[t.jsxs(x,{children:["Hình ảnh",t.jsx(d,{color:"danger",children:"*"})]}),t.jsx(f,{disabled:w,onChange:S,ratio:"16/9",fit:"contain"})]}),t.jsx(v,{onSuccess:T,onError:()=>T(""),onExpire:()=>T("")})]}),t.jsx(i,{children:t.jsx(p,{disabled:w||V.length<5||V.length>125||null===C||!P,loadingPosition:"start",onClick:L,loading:w,variant:"soft",children:"Đăng tải hình ảnh"})})]})})}export{b as default};
