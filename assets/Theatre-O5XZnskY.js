import{r as e,u as s,F as a,j as t,ag as l,I as n,l as i,c as r,T as c,b4 as o,bl as d,bm as m,aC as u,am as h,g as v,h as g}from"./index-G_uMOMri.js";function p({cls:l,mvCallback:n}){const[i,r]=e.useState([]),c=s();return e.useEffect((()=>{a({url:"watch/theatre",data:{action:"movie"},success:e=>{e.data&&r(e.data)},error:e=>{c.error(""!==e.message?e.message:"Lỗi không xác định!")}})}),[]),t.jsx("div",{className:l.SelectMovie,children:i.map(((e,s)=>t.jsx("div",{onClick:()=>n(e.id,e.title,e.thumb),className:l.SelectMovieItem,children:t.jsx("div",{className:l.Image,style:{backgroundImage:"url("+e.thumb+")"}})},s)))})}const x="/assets/loginbanner-3kylquIZ.png",j=l.createContext({}),f=!0;function N({baseColor:e,highlightColor:s,width:a,height:t,borderRadius:l,circle:n,direction:i,duration:r,enableAnimation:c=f}){const o={};return"rtl"===i&&(o["--animation-direction"]="reverse"),"number"==typeof r&&(o["--animation-duration"]=`${r}s`),c||(o["--pseudo-element-display"]="none"),"string"!=typeof a&&"number"!=typeof a||(o.width=a),"string"!=typeof t&&"number"!=typeof t||(o.height=t),"string"!=typeof l&&"number"!=typeof l||(o.borderRadius=l),n&&(o.borderRadius="50%"),void 0!==e&&(o["--base-color"]=e),void 0!==s&&(o["--highlight-color"]=s),o}function b({count:e=1,wrapper:s,className:a,containerClassName:t,containerTestId:n,circle:i=!1,style:r,...c}){var o,d,m;const u=l.useContext(j),h={...c};for(const[l,j]of Object.entries(c))void 0===j&&delete h[l];const v={...u,...h,circle:i},g={...r,...N(v)};let p="react-loading-skeleton";a&&(p+=` ${a}`);const x=null!==(o=v.inline)&&void 0!==o&&o,b=[],S=Math.ceil(e);for(let j=0;j<S;j++){let s=g;if(S>e&&j===S-1){const a=null!==(d=s.width)&&void 0!==d?d:"100%",t=e%1,l="number"==typeof a?a*t:`calc(${a} * ${t})`;s={...s,width:l}}const a=l.createElement("span",{className:p,style:s,key:j},"‌");x?b.push(a):b.push(l.createElement(l.Fragment,{key:j},a,l.createElement("br",null)))}return l.createElement("span",{className:t,"data-testid":n,"aria-live":"polite","aria-busy":null!==(m=v.enableAnimation)&&void 0!==m?m:f},s?b.map(((e,a)=>l.createElement(s,{key:a},e))):b)}const S=e=>!0===e.skeleton?t.jsx("div",{className:r(e.cls.WatchItem,e.cls.Skeleton),children:t.jsx(b,{className:"abs"})}):t.jsxs("div",{onClick:e.onClick,className:r(e.cls.WatchItem,e.thisItem&&e.cls.this),alt:"ep",children:[t.jsx("img",{srcSet:e.thumb,alt:"Mon Fansub",className:e.cls.Thumbnail}),t.jsxs("div",{className:e.cls.Info,children:[t.jsx("span",{className:e.cls.InfoSubtitle,children:e.movieTitle}),t.jsx("h5",{className:e.cls.InfoMainTitle,children:e.epTitle})]})]});function k({cls:l,mid:r,epId:c,setEpId:o}){const[d,m]=e.useState([]),[u,h]=e.useState(""),[v,g]=e.useState("1"===window.localStorage.getItem("MFS_THEATRE_SEARCH")),[p,x]=e.useState("0"),[j,f]=e.useState(0),[N,b]=e.useState(0),k=s(),C=e.useCallback((()=>{v?(g(!1),window.localStorage.removeItem("MFS_THEATRE_SEARCH")):(g(!0),window.localStorage.setItem("MFS_THEATRE_SEARCH","1"))}),[v]),y=e.useCallback((()=>{m([]),a({url:"playerSelector",data:{search:u,page:p,mid:r},success:e=>{m(e.data.data),f(e.data.totalPage),b(e.data.currentPage),e.data.data.length<1&&k.error("Không tìm thầy tập phim!")},error:e=>{k.error(""!==e.message?"Lỗi: "+e.message:"Lỗi không xác định!")}})}),[u,p,r]);return e.useEffect((()=>{r>0&&y()}),[r,p]),t.jsxs("div",{className:l.SelectEpisode,children:[t.jsxs("div",{className:l.SelectControl,children:[v&&t.jsx(n,{size:"md",startDecorator:t.jsx("i",{className:"fa-duotone fa-magnifying-glass"}),className:l.Search,placeholder:"Tìm kiếm",value:u,color:"neutral",onKeyDown:e=>{"Enter"===e.key&&y()},onChange:e=>h(e.target.value)}),t.jsxs("div",{className:l.SelectPage,children:[t.jsx(i,{className:l.SelectPageButton,onClick:C,color:"neutral",variant:v?"solid":"soft",children:t.jsx("i",{className:"fa-duotone fa-magnifying-glass"})}),[...Array(j)].map(((e,s)=>t.jsx(i,{className:l.SelectPageButton,onClick:()=>{s+1!==N&&x(s+1)},color:"neutral",disabled:d.length<1,variant:s+1===N?"solid":"soft",children:s+1},s)))]})]}),t.jsx("div",{className:l.SelectContent,children:d.length<1?[0,1,2,3,4,5,6,7,8,9,10,11].map(((e,s)=>t.jsx(S,{skeleton:!0,cls:l},s))):d.map((e=>t.jsx(S,{skeleton:!1,thisItem:e.id===c,onClick:()=>o(e.id),movieTitle:e.movieName,episode:e.episode,epTitle:e.title,thumb:e.thumbnail,cls:l},e.id*Math.random())))})]})}function C({className:s}){const[a,l]=e.useState("00:00");return e.useEffect((()=>{const e=setInterval((()=>{let e=new Date,s=e.getHours(),a=e.getMinutes();l((s<10?"0":"")+s+":"+(a<10?"0":"")+a)}),500);return()=>clearInterval(e)}),[]),t.jsx(c,{level:"h6",className:s,children:a})}function y({cls:l,epid:n,openDash:m}){const u=e.useRef(null),[h,v]=e.useState(!1),[g,p]=e.useState(!0),[x,j]=e.useState({}),[f,N]=e.useState(0),b=s(),S=e.useCallback((()=>{j({}),v(!1),p(!0),a({url:"play",data:{epid:n},success:e=>{if(p(!1),j(e.data),"object"==typeof e.data.server)for(let s=0;s<e.data.server.length;s++)if(""!==e.data.server[s].url){N(s);break}},error:e=>{v(!0),b.error(""!==e.message?"Lỗi: "+e.message:"Lỗi không xác định!")}})}),[n]);e.useEffect((()=>{if(!(n<1))return S(),()=>{j({}),v(!1),p(!0)}}),[n]);const[k,y]=e.useState(!0);return e.useEffect((()=>{if(n<1)return;let e;const s=()=>{clearTimeout(e),y(!0),e=setTimeout((()=>{y(!1)}),3e3)};return u.current&&(u.current.addEventListener("mousemove",s),u.current.addEventListener("touchstart",s)),()=>{u.current&&(u.current.removeEventListener("mousemove",s),u.current.removeEventListener("touchstart",s))}}),[n]),n<1?t.jsx("div",{className:r(l.VideoPlayer,l.hide)}):t.jsxs("div",{ref:u,className:r(l.VideoPlayer,n<1&&l.hide),children:[t.jsxs("div",{className:r(l.VideoHeader,k&&l.showHeader),children:[t.jsx(c,{level:"h5",children:x.title?x.title:"Đang tải dữ liệu..."}),t.jsxs("div",{className:l.VideoHeaderAction,children:[t.jsx(C,{className:l.Clock}),t.jsx(i,{onClick:m,variant:"plain",color:"neutral",children:t.jsx("i",{className:"fa-duotone fa-house"})})]})]}),t.jsx("div",{className:l.VideoMain,children:h?t.jsxs("div",{className:l.PlayerFrameError,children:[t.jsx("i",{className:"fa-duotone fa-triangle-exclamation"}),t.jsxs("div",{className:l.ErrorContent,children:[t.jsx("h2",{children:"Tập phim không tồn tại hoặc đã bị xóa"}),t.jsx("p",{children:"Vui lòng kiểm tra lại liên kết của bạn!"})]})]}):g?t.jsx(o,{}):t.jsx(d,{options:{language:"vi",autoplay:!0,controls:!0,responsive:!0,fluid:!0,sources:[{src:x.server[f].url,type:"m3u8"===x.server[f].url.split(".").pop()||"m3u"===x.server[f].url.split(".").pop()?"application/x-mpegURL":"video/mp4"}]},className:l.MainVideo,mfsSubtitle:x.sub,idt:x.idt,openingFrom:x.openingFrom,endingFrom:x.endingFrom,openingEnd:x.openingEnd,endingEnd:x.endingEnd})})]})}function E({disableTheatre:s,cls:a}){const{userData:l}=m(),[n,o]=e.useState(0),[d,j]=e.useState(""),[f,N]=e.useState(x),[b,S]=e.useState(0),[E,I]=e.useState(!1),T=e.useCallback((()=>{o(0),N(x)}),[n]);return t.jsxs("div",{className:a.Theatre,children:[t.jsx("div",{className:a.Background,style:{backgroundImage:`url(${f})`}}),t.jsx(y,{cls:a,epid:b,openDash:()=>I(!1)}),t.jsxs("div",{className:r(a.Dash,E&&a.hideDash),children:[t.jsxs("div",{className:a.Header,children:[t.jsxs("div",{className:r(a.TopContent,n>0?a.choosedFilm:""),children:[t.jsxs(c,{level:"h5",className:a.legend,children:["Chào mừng bạn, ",l.name]}),t.jsxs("div",{className:a.TopContentAction,children:[t.jsx(i,{onClick:T,variant:"plain",color:"neutral",children:t.jsx("i",{className:"fa-solid fa-chevron-left"})}),t.jsx(c,{level:"h5",className:a.title,children:d})]})]}),t.jsxs("div",{className:a.HeaderAction,children:[t.jsx(C,{className:a.Clock}),t.jsx(u,{title:"Trở về chế độ bình thường",children:t.jsx(h,{srcSet:l.avatar,className:a.Avatar,onClick:async()=>{"CONFIRMED"===await v.show({type:g.Confirm,title:"MFS Theatre",message:t.jsx(t.Fragment,{children:"Bạn có muốn quay về chế độ bình thường không?"})})&&s()}})}),b>0&&t.jsxs(t.Fragment,{children:[t.jsx(u,{title:"Dừng video",children:t.jsx(i,{className:a.closeDashBtn,onClick:()=>S(0),variant:"plain",color:"neutral",children:t.jsx("i",{className:"fa-solid fa-stop"})})}),t.jsx(u,{title:"Quay trở lại video",children:t.jsx(i,{className:a.closeDashBtn,onClick:()=>I(!0),variant:"plain",color:"neutral",children:t.jsx("i",{className:"fa-solid fa-xmark"})})})]})]})]}),t.jsxs("div",{className:r(a.Content,n>0?a.choosedFilm:""),children:[t.jsx(p,{mvCallback:(e,s,a)=>{o(e),j(s),N(a)},cls:a}),t.jsx(k,{cls:a,mid:n,epId:b,setEpId:e=>{S(e),I(!0)}})]})]})]})}export{E as default};
